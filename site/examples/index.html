<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Climb and area code examples</title>
  <meta name="description" content="experiment with climb and area codes">
  <link rel="stylesheet" href="../main.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
          integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
          crossorigin=""></script>
</head>

<body>

<style>
  main {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    display: flex;
  }

  .geohash-icon {
    font-size: 10px;
    line-height: 12px;
    border: solid 1px black;
    background-color: white;
    text-align: center;
  }

  .area-icon {
    border: solid 1px black;
    background-color: blue;
    border-radius: 50%;
  }

  .climb-icon {
    border: solid 1px black;
    background-color: orange;
    border-radius: 50%;
  }

  #example-map {
    width: 60%;
    height: 100vh;
  }

  #example-text {
    width: 40%;
    height: 100vh;
    padding: 1em;
    overflow-y: scroll;
  }
</style>

<main>
  <div id="example-map"></div>
  <section id="example-text">
    <h1>[WIP] Climb &amp; Area Code Examples</h1>
    <p>These examples revolve around climbs in Yosemite Valley.</p>
    <button id=focus-yosemite>Focus on Yosemite Valley</button>
    <hr>
    <aside class=todo>add examples to highlight potential conflicts</aside>
    <aside class=todo>better visualize how likely conflicts are</aside>
    <aside class=todo>make radii adjustable (to experiment)</aside>
  <section>
</main>

<script>
  var map = L.map('example-map', {
    zoomControl: false,
  }).setView({
    "lat": 37.70555348721583,
    "lng": -119.53399658203126
  }, 6);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  let yosemite = [37.7348, -119.6067];
  let tuolumne = [37.8472, -119.4359]
  let redRocks = [36.15, -115.46];

  let happyBoulders = [37.41712615728517, -118.45059837595089];
  let sadBoulders = [37.420062594663506, -118.43410533158263];
  let buttermilks = [37.32881243152914, -118.57601442025562];

  let theNose = [37.728263, -119.636429];
  let midnightLightning = [37.74175049841879, -119.60350876180672];
  let snakeDike = [37.74080601297071, -119.53959835291352];
  let plumbersCrack = [36.159901156092936, -115.41711407792825];
  let highExposure = [41.74125492959943, -74.18214106803914]; // maybe wrong

  function geohashMarker(pt, hash){
    let chars = hash.length;
    let a = document.createElement('a');
    a.setAttribute('href', 'http://geohash.org/' + hash);
    a.innerHTML = 'geohash ' + hash;
    let i = L.divIcon({
      html: hash,
      iconSize: [((hash.length * 6) + 4), 12],
      className: 'geohash-icon',
    });
    return L.marker(pt, {icon: i}).bindPopup(a);
  }

  function climbMarker(pt, n){
    let i = L.divIcon({
      iconSize: [15, 15],
      className: 'climb-icon',
    });
    let marker = L.marker(pt, {
      icon: i
    }).bindPopup(n);
    var circle = L.circle(pt, {
      color: 'orange',
      fill: false,
      dashArray: '5 8',
      radius: 5 * 1000
    }).bindPopup('the code for ' + n + ' should be unique within 5km');
    marker.addTo(map);
    circle.addTo(map);
  }

  function areaMarker(pt, n){
    let i = L.divIcon({
      iconSize: [18, 18],
      className: 'area-icon',
    });
    let marker = L.marker(pt, {
      icon: i
    }).bindPopup('center for ' + n);
    var circle = L.circle(pt, {
      color: 'blue',
      fill: false,
      dashArray: '5 8',
      radius: 300 * 1000
    }).bindPopup('the code for ' + n + ' should be unique within 300km');
    marker.addTo(map);
    circle.addTo(map);
  }


  document.getElementById('focus-yosemite').onclick = function focusYosemite(){
    map.flyTo({
      lat: 37.742756727055514,
      lng: -119.60367878381095
    }, 12})
  }

  let geohashes = {
    '9qd': [37, -120],
    '9qe': [37, -119],
    '9qf': [39, -120],
    '9qg': [39, -119],
    '9qdyts': [37.73, -119.6],
    '9qdywq': [37.74, -119.6],
    // '9qmvtw': [36.16, -115.4],
  };

  let geohashMarkers = {};

  for (let key in geohashes) {
    geohashMarkers[key] = geohashMarker(geohashes[key], key);
    geohashMarkers[key].addTo(map);
  }

  climbMarker(theNose, 'The Nose');
  climbMarker(midnightLightning, 'Midnight Lightning');
  climbMarker(snakeDike, 'Snake Dike');

  areaMarker(yosemite, 'Yosemite Valley');
  areaMarker(tuolumne, 'Tuolumne Meadows');
  areaMarker(happyBoulders, 'Happy Boulders');
  areaMarker(sadBoulders, 'Sad Boulders');
  areaMarker(buttermilks, 'Buttermilks');
  areaMarker(redRocks, 'Red Rocks');

  map.on('click', e => console.log(e))

</script>

</body>
</html>

